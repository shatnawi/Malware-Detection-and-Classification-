import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.PrintWriter;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.util.Arrays;
import java.util.Iterator;


import org.json.simple.*;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

public class Reader {
	
	public static void main(String[]args) throws FileNotFoundException, IOException, ParseException {
		
		final File folder = new File("D:\\Copy of PANW_AndroidMalwareFamily (2020_12_10 12_21_08 UTC)\\output\\\\benign");
PrintWriter pr2= new PrintWriter(new File("Filenames.txt"));
PrintWriter pr= new PrintWriter(new File("Dynamic_Results.txt"));
		
		listFilesForFolder(folder, pr,pr2);
		pr.close();
		pr2.close();
	}

	public static void listFilesForFolder(final File folder, PrintWriter pr,PrintWriter pr2 ) throws FileNotFoundException, IOException, ParseException {
		
		
		
		
	    for (final File fileEntry : folder.listFiles()) {
	        if (fileEntry.isDirectory()) {
	            listFilesForFolder(fileEntry, pr,pr2);
	        } else {
	        	if(fileEntry.getName().contains("_da")) {
	           
	        		System.out.println(fileEntry.getAbsolutePath());
	            
	            
	        		 Object object = new JSONParser().parse(new FileReader(fileEntry.getAbsolutePath()));

		                // typecasting ob to JSONObject
		                JSONObject js = (JSONObject) object;

		                
		                JSONObject js2 =  (JSONObject)js.get("report");
		                JSONObject js3 =  (JSONObject)js2.get("apk_api");
		                
		                
		                if (js3.get("Suspicious_Action_Monitored") instanceof JSONArray)
		                {
		                	
		                	
		                	   JSONArray countries = (JSONArray)js3.get("Suspicious_Action_Monitored");
		                	   
		                	   String out="";
				                for (int i = 0 ; i < countries.size(); i++) {
				                    JSONObject obj = (JSONObject)countries.get(i);
				                    
				                String action=obj.get("Action").toString();
				                String perm=obj.get("Details").toString();
				                
				                action=action.replace("APK file ", "");
				                action=action.replace("_", "");
				                action=action.replace("-", "");
				                action=action.replace("{", "");
				                action=action.replace("}", "");
				                action=action.replace("@", "");
				                action=action.replace("'", "");
				                action=action.replace("$","");
				                action=action.replace("%","");
				                action=action.replace("&","");  
				                action=action.replace("?",""); 
				                action=action.replace("\"","");
				                action=action.replace("(", "");
				                action=action.replace(")", "");
				                action=action.replace("<","");
				                action=action.replace(">","");
				                action=action.replace("[","");
				                action=action.replace("]","");
				                action=action.replaceAll("\\s+","");
				                
				                action=action.toLowerCase();
				                
				                perm=perm.replace("_", "");
				                perm=perm.replace("-", "");
				                perm=perm.replace("{", "");
				                perm=perm.replace("}", "");
				                perm=perm.replace("@", "");
				                perm=perm.replace("'", "");
				                perm=perm.replace("$","");
				                perm=perm.replace("%","");
				                perm=perm.replace("&","");  
				                perm=perm.replace("?",""); 
				                perm=perm.replace("\"","");
				                perm=perm.replace("(", "");
				                perm=perm.replace(")", "");
				                perm=perm.replace("<","");
				                perm=perm.replace(">","");
				                perm=perm.replace("[","");
				                perm=perm.replace("]","");
				                
				                perm=perm.toLowerCase();
				                perm=perm.replaceAll("\\s+","");
				                if(i==countries.size()-1)
				                out=out+action+perm;
				                else
				                	   out=out+action+perm+"|";
				                
				                
				                
				                
				                }
				                
				               
				                pr.println(out);
					               
					               pr.flush();
					               pr2.println(fileEntry.getName());
					               pr2.flush();
				                
		                }
		                else {
		                	 
		                	  JSONObject obj = (JSONObject)js3.get("Suspicious_Action_Monitored");
		                	  String action=obj.get("Action").toString();
				                String perm=obj.get("Details").toString();
				                
				                action=action.replace("APK file ", "");
				                action=action.replace("_", "");
				                action=action.replaceAll("\\s+","");
				                action=action.toLowerCase();
				                perm=perm.replace("_", "");
				                perm=perm.replace("(", "");
				                perm=perm.replace(")", "");
				                perm=perm.replace(",", "");
				                perm=perm.replace(":", "");
				                perm=perm.replace("/", "");
				                perm=perm.replace(".", "");
				                perm=perm.toLowerCase();
			                	
				                
				                
				              //  System.out.println(action+"^"+perm);
				                pr.println(action+perm);
					               
					               pr.flush();
					               pr2.println(fileEntry.getName());
					               pr2.flush();
				                
		                }
		                
		                
		             
	            try
	            {
	               
	                


	        		
	          //      Object object = new JSONParser().parse(new FileReader(fileEntry.getAbsolutePath()));

	          //      JSONObject js = (JSONObject) object;

	                
	           //     JSONObject js2 =  (JSONObject)js.get("report");
	           //     JSONObject js3 =  (JSONObject)js2.get("apk_api");
	         //       JSONArray countries = (JSONArray)js3.get("Suspicious_Action_Monitored");
	                
	          
	            }
	            catch(Exception e)
	            {
	                e.printStackTrace();
	            }
	        	}
	        	/*
		                else if(fileEntry.getName().contains("_sa")) {
	        		// System.out.println(fileEntry.getAbsolutePath());
	        		
	        		//Requested_Permissions
	        		 Object object = new JSONParser().parse(new FileReader(fileEntry.getAbsolutePath()));

		                // typecasting ob to JSONObject
		                JSONObject js = (JSONObject) object;

		                
		                JSONObject js2 =  (JSONObject)js.get("report");
		                JSONObject js3 =  (JSONObject)js2.get("static_analysis");
		               
		                String intent="";
		                String perm="";
		                
		                
		                
		                if (js3.get("Defined_Intent_Filters") instanceof JSONObject)
		                {
		                JSONObject js_4 =  (JSONObject)js3.get("Defined_Intent_Filters");
		               
		              
		            //    if() {
		                Object obj1 = js_4.get("entry");
		                
		                if (obj1 instanceof JSONArray)
		                {
		                	JSONArray countries = (JSONArray)js_4.get("entry");
		                	String ar= countries.toJSONString();
		                	ar =ar.replace("\"", "");
		                	ar =ar.replace("[", "");
		                	ar =ar.replace("]", "");
		               // 	ar =ar.replace("android.intent.", "");
		                	
		                	
		                	
		                	
		                	
		                	ar =ar.replace(",", "|");
		                	ar =ar.replace(".", "");
		                	intent=ar.toLowerCase();
		                	
		                }
		                else {
		                    String name = (String) js_4.get("entry");
		                    intent=name.toLowerCase();
		                    intent=intent.replace(".", "");
		                  //  System.out.println(name);

		                }
		                }
		                
		                
		                
		                
		                
		                
		                
		                
		                
		                
		                
		                
		                
		                
		                if (js3.get("Requested_Permissions") instanceof JSONObject)
		                {
		                JSONObject js4 =  (JSONObject)js3.get("Requested_Permissions");
		               
		              
		            //    if() {
		                Object obj1 = js4.get("entry");
		                
		                if (obj1 instanceof JSONArray)
		                {
		                	JSONArray countries = (JSONArray)js4.get("entry");
		                	String ar= countries.toJSONString();
		                	ar =ar.replace("\"", "");
		                	ar =ar.replace("[", "");
		                	ar =ar.replace("]", "");
		                	
		                //	ar =ar.replace("android.permission.", "");
		               // 	ar =ar.replace("com.android.launcher.permission.", "");
		               // 	
		                	
		                	
		                	
		                	ar =ar.replace(",", "|");
		                	ar =ar.replace(".", "");
		                	perm=ar.toLowerCase();
		                	
		                }
		                else {
		                    String name = (String) js4.get("entry");
		                    perm=name.toLowerCase();
		                    perm=perm.replace(".", "");
		                  //  System.out.println(name);

		                }
		                }
		                
		                String finalS =perm+"|"+intent;
		             //   System.out.println(finalS);
		               pr.println(finalS);
		               
		               pr.flush();
		               pr2.println(fileEntry.getName());
		               pr2.flush();

		              //  }
		               
		                
		                
	        	}
	            
	            
	           */ 
	            
	            
	        }
	    }
	  //  pr.close();
	}
	
	

}
